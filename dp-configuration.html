<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta content="width=device-width, minimum-scale=1, maximum-scale=1" name="viewport">
<title>Configuration</title>
<link href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" rel="stylesheet" type="text/css" />
<script src="http://code.jquery.com/jquery-1.6.4.min.js" type="text/javascript"></script>
<script src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js" type="text/javascript"></script>
</head>

<body>
<div data-role="page" id="page">
  <div data-role="header">
    <h1>Configuration</h1>
  </div>
  <div data-role="content">
    <p align="center">Paste your Forecast.io API key here.</p>
    <p align="center"><a href="https://developer.forecast.io" target="new"><em>Don't have one? Get one for free.</em></a></p>
    <label for="apikey"></label>
    <input type="text" name="apikey" id="apikey" value=""  />
    &nbsp;
    <p align="center">Select the units that you want the temperature displayed in.</p>
      <select name="flipswitch" id="units" data-role="slider">
        <option value="F">Fahrenheit</option>
        <option value="C">Celsius</option>
      </select>
      &nbsp;
    <button id="submitButton" data-icon="check">Done</button>
    <button id="cancelButton" data-icon="back">Cancel</button>
  </div>
  <div data-role="footer">
    <h4><a href="http://forecast.io/" target="new">Powered by Forecast</a></h4>
  </div>
</div>
<script>
	function save()
	{
		var key = { 'apiKey': $("#apikey").val(), 'units': $("#units").val() };
		return key;
	}
	
	function getParameterByName(name) 
	{
    	name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    	var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
    	    results = regex.exec(location.search);
    	return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}
	
	$().ready(function(e) 
	{
		$("#apikey").val(getParameterByName("apiKey"));
		$("#units").val(getParameterByName("units")).slider('refresh');
		$("#submitButton").click(function(e) {
			var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(save()));
			console.log("Jumping to "+location);
			document.location = location;
		});
		
		$("#cancelButton").click(function(e) {
            console.log("Canceling...");
			document.location = "pebblejs://close#";
        });
	});
</script>
</body>
</html>
